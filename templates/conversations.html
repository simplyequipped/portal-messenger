<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Portal Messenger</title>
		<link rel="stylesheet" type="text/css" href="../static/style.css" />
		<script src="../static/jquery.min.js"></script>
		<script src="../static/socket.io.min.js"></script>
		<script src="../static/common.js"></script>
		<script src="../static/conversation.js"></script>
    </head>
    <body>
	    <div class="header">
			PORTAL MESSENGER
		    <a href="/settings"><span class="icon icon-settings">&nbsp;</span></a>
		</div>
		<div class="details">
			<div class="details-name">Conversations</div>
		</div>
		<div class="viewport">
			<div class="content">

				<!-- hidden element for cloning -->
				<div class="conversation original-hidden">
					<div class="presence-indicator presence-unknown">&nbsp;</div>
					<div class="chat-name">&nbsp;</div>
					<div class="last-heard">&nbsp;</div>
				</div>
			</div>

		</div>
		<div class="footer">&nbsp;</div>

    </body>
	<script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);

        socket.on('connect', function() {
            socket.emit('log', {msg: 'Connected to socket'});
        });

		socket.on('heard', function( data ) {
			if ( findConversation(data.username).length == 0 ) {
				newConversation(data.username);
			}
			setPresence(data.username, 'active');
			setLastHeard(data.username, data.last_heard);
		});

		newConversation("Timothy Smith");
		setPresence("Timothy Smith", "active");
		setLastHeard("Timothy Smith", "2 minutes ago");
		newConversation("Someone Else");
		setPresence("Someone Else", "unknown");
		setLastHeard("Someone Else", "1 day ago");
		newConversation("Jane Doe");
		setPresence("Jane Doe", "inactive");
		setLastHeard("Jane Doe", "3 hours ago");
		
		markUnread("Timothy Smith");
	</script>
</html>
